# Настройка GitHub Secrets для CI/CD

Для работы автоматического деплоя необходимо настроить следующие секреты в GitHub репозитории.

## Как добавить секреты

1. Перейдите в ваш GitHub репозиторий
2. Откройте **Settings** → **Secrets and variables** → **Actions**
3. Нажмите **New repository secret**
4. Добавьте каждый из следующих секретов:

## Обязательные секреты

### SERVER_IP
```
109.205.56.225
```

### SSH_USER
```
korobkov
```

### SSH_PRIVATE_KEY
Содержимое приватного SSH ключа с сервера:
```bash
# На сервере выполните:
cat ~/.ssh/id_rsa
```
Скопируйте ВЕСЬ вывод, включая строки `-----BEGIN OPENSSH PRIVATE KEY-----` и `-----END OPENSSH PRIVATE KEY-----`

### DB_HOST
IP адрес или хост базы данных PostgreSQL:
```
localhost
# или IP вашей внешней БД
```

### DB_PORT
```
5432
```

### DB_USERNAME
```
postgres
```

### DB_PASSWORD
Пароль от базы данных PostgreSQL

### DB_NAME
```
hookapedia
```

## Опциональные секреты

### JWT_SECRET (если используется)
Секретный ключ для JWT токенов:
```bash
# Сгенерируйте случайную строку
openssl rand -base64 32
```

## Проверка настройки

После добавления всех секретов:

1. Сделайте любое изменение в коде
2. Выполните `git push origin master`
3. Перейдите в **Actions** вашего репозитория
4. Убедитесь, что workflow запустился успешно

## Структура workflow

### Build Job
- Собирает Docker образ
- Загружает в GitHub Container Registry (ghcr.io)
- Использует кэширование для ускорения

### Deploy Job
- Подключается к серверу по SSH
- Скачивает новый Docker образ
- Останавливает старый контейнер
- Запускает новый контейнер с переменными окружения
- Очищает старые образы

## Мониторинг

Для просмотра логов запущенного контейнера на сервере:
```bash
ssh korobkov@109.205.56.225
docker logs hookapedia-backend -f
```

Для проверки статуса:
```bash
docker ps
```

## Отладка

Если деплой не работает:

1. Проверьте логи в GitHub Actions
2. Убедитесь, что все секреты добавлены правильно
3. Проверьте подключение к серверу:
   ```bash
   ssh korobkov@109.205.56.225
   ```
4. Проверьте Docker на сервере:
   ```bash
   docker version
   docker compose version
   ```
